/* syngen v0.2.1 */
(()=>{"use strict";const t=(()=>{const t=new Promise(t=>{document.addEventListener("DOMContentLoaded",t)});return{input:{},prop:{},ready:e=>"function"==typeof e?t.then(e):t}})();t.utility={},t.utility.addInterval=(t,e)=>t*2**e,t.utility.between=(t,e,i)=>t>=e&&t<=i,t.utility.centroid=(e=[])=>{if(!e.length)return t.utility.vector3d.create();let i=0,n=0,r=0;for(const t of e)i+=t.x||0,n+=t.y||0,r+=t.z||0;return t.utility.vector3d.create({x:i/e.length,y:n/e.length,z:r/e.length})},t.utility.choose=(e=[],i=0)=>{i=t.utility.clamp(i,0,1);return e[Math.round(i*(e.length-1))]},t.utility.chooseSplice=(e=[],i=0)=>{i=t.utility.clamp(i,0,1);const n=Math.round(i*(e.length-1));return e.splice(n,1)[0]},t.utility.chooseWeighted=(e=[],i=0)=>{let n=(i=t.utility.clamp(i,0,1))*e.reduce((t,e)=>t+(e.weight||0),0);for(const t of e)if(n-=t.weight||0,n<=0)return t},t.utility.clamp=(t,e,i)=>t>i?i:t<e?e:t,t.utility.closer=(t,e,i)=>Math.abs(t-e)<=Math.abs(t-i)?e:i,t.utility.closest=function(e,i=[]){return i.reduce((i,n)=>t.utility.closer(e,i,n))},t.utility.createNoiseWithOctaves=({seed:t,octaves:e=0,type:i}={})=>{if(!(i&&i.create&&i.prototype&&i.prototype.reset&&i.prototype.value))throw new Error("Incorrect type. Please pass a noise utility by reference, e.g. syngen.utility.simplex4d.");if((e=Math.round(e))<2)return i.create(t);const n=1/(1-2**-e),r=[];Array.isArray(t)||(t=[t]);for(let n=0;n<e;n+=1)r.push(i.create(...t,"octave",n));return{layer:r,reset:function(){for(let t of this.layer)t.reset();return this},value:function(...t){let e=.5,i=1,r=0;for(let n of this.layer)r+=n.value(t[0]*i,t[1]*i,t[2]*i,t[3]*i)*e,e/=2,i*=2;return r*=n,r}}},t.utility.createPerlinWithOctaves=(e,i,n)=>{const r=t.utility.createNoiseWithOctaves({octaves:n,seed:i,type:e});return r.perlins=r.layers,r},t.utility.degreesToRadians=t=>t*Math.PI/180,t.utility.detune=(t,e=0)=>t*2**(e/1200),t.utility.distance=(e,i)=>Math.sqrt(t.utility.distance2(e,i)),t.utility.distance2=({x:t=0,y:e=0,z:i=0}={},{x:n=0,y:r=0,z:o=0}={})=>(n-t)**2+(r-e)**2+(o-i)**2,t.utility.distanceToPower=(e=0)=>{const i=(e=Math.max(1,e+1))**-t.const.distancePower;let n=1;if(t.const.distancePowerHorizon){const i=t.streamer.getRadius()+1;n=Math.max(0,i-e)/i,n**=t.const.distancePowerHorizonExponent}return i*n},t.utility.frequencyToMidi=e=>12*Math.log2(e/t.const.midiReferenceFrequency)+t.const.midiReferenceNote,t.utility.fromDb=t=>10**(t/10),t.utility.hash=t=>{let e=0,i=(t=String(t)).length;for(;i--;)e+=t.charCodeAt(i),e+=e<<10,e^=e>>6;return e+=e<<3,e^=e>>11,e+=e<<15,Math.abs(e)},t.utility.humanize=(e=1,i=0)=>e+t.utility.random.float(-i,i),t.utility.humanizeDb=(e=1,i=0)=>{const n=t.utility.fromDb(i);return e*t.utility.random.float(1-n,1+n)},t.utility.intersects=({depth:e=0,height:i=0,width:n=0,x:r=0,y:o=0,z:a=0}={},{depth:s=0,height:u=0,width:c=0,x:h=0,y:l=0,z:d=0}={})=>{const y=t.utility.between,f=y(r,h,h+c)||y(h,r,r+n),p=y(o,l,l+u)||y(l,o,o+i),m=y(a,d,d+s)||y(d,a,a+e);return f&&p&&m},t.utility.lerp=(t,e,i=0)=>t*(1-i)+e*i,t.utility.lerpExp=(e,i,n=0,r=2)=>t.utility.lerp(e,i,n**r),t.utility.lerpExpRandom=([e,i],[n,r],o,a)=>t.utility.random.float(t.utility.lerpExp(e,n,o,a),t.utility.lerpExp(i,r,o,a)),t.utility.lerpLog=(e,i,n=0,r=2)=>(n*=r-1,t.utility.lerp(e,i,Math.log(1+n)/Math.log(r))),t.utility.lerpLogi=(e,i,n,r)=>t.utility.lerpLog(i,e,1-n,r),t.utility.lerpLogiRandom=([e,i],[n,r],o)=>t.utility.random.float(t.utility.lerpLogi(e,n,o),t.utility.lerpLogi(i,r,o)),t.utility.lerpLogRandom=([e,i],[n,r],o,a)=>t.utility.random.float(t.utility.lerpLog(e,n,o,a),t.utility.lerpLog(i,r,o,a)),t.utility.lerpRandom=([e,i],[n,r],o)=>t.utility.random.float(t.utility.lerp(e,n,o),t.utility.lerp(i,r,o)),t.utility.midiToFrequency=e=>t.const.midiReferenceFrequency*Math.pow(2,(e-t.const.midiReferenceNote)/12),t.utility.normalizeAngle=(t=0)=>{const e=2*Math.PI;return t>e?t%=e:t<0&&(t%=e,t+=e),t},t.utility.normalizeAngleSigned=t=>{const e=2*Math.PI;return(t%=e)>Math.PI&&(t-=e),t<-Math.PI&&(t+=e),t},t.utility.quadratic=(t,e,i)=>[(-1*e+Math.sqrt(Math.pow(e,2)-4*t*i))/(2*t),(-1*e-Math.sqrt(Math.pow(e,2)-4*t*i))/(2*t)],t.utility.radiansToDegrees=t=>180*t/Math.PI,t.utility.regularPolygonInteriorAngle=t=>(t-2)*Math.PI/t,t.utility.round=(t,e=0)=>(e=10**e,Math.round(t*e)/e),t.utility.scale=(t,e,i,n,r)=>(r-n)*(t-e)/(i-e)+n,t.utility.shuffle=(t,e=Math.random)=>{for(let i=(t=[].slice.call(t)).length-1;i>0;i--){const n=Math.floor(e()*(i+1));[t[i],t[n]]=[t[n],t[i]]}return t},t.utility.sign=t=>t>=0?1:-1,t.utility.srand=(...e)=>{const i=34359738337,n=t=>(185852*t+1)%i;let r=t.utility.hash(t.seed.concat(...e));r=n(r);return(t=0,e=1)=>(r=n(r),t+r/i*(e-t))},t.utility.toCents=(t,e)=>(e-t)/t*1200,t.utility.toDb=t=>10*Math.log10(t),t.utility.toSubFrequency=(e,i=t.const.subFrequency,n=t.const.minFrequency)=>{for(;e>i;)e/=2;for(;e<n;)e*=2;return e},t.utility.uuid=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)),t.utility.wrap=(t,e=0,i=1)=>{const n=i-e;return t>=i?e+(t-e)%n:t<e?e+(t+i)%n:t},t.utility.wrapAlternate=(t,e=0,i=1)=>{const n=i-e,r=2*n;return t>i?(t-=e)%r<n?e+t%n:i-t%n:t<e?Math.abs(t%r)<n?i-n+Math.abs(t%n):e+n-Math.abs(t%n):t},t.utility.bitree={},t.utility.bitree.create=function(t={}){return Object.create(this.prototype).construct(t)},t.utility.bitree.from=function(t=[],e={}){const i=this.create(e);for(const e of t)i.insert(e);return i},t.utility.bitree.prototype={clear:function(){return this.items.length=0,this.nodes.length=0,this},construct:function({dimension:e="value",maxItems:i=12,minValue:n=-t.const.maxSafeFloat,range:r=2*t.const.maxSafeFloat}={}){return this.dimension=e,this.items=[],this.maxItems=i,this.minValue=n,this.nodes=[],this.range=r,this},destroy:function(){return this.clear()},find:function(t,e=1/0){if(!(this.dimension in t))return;if(isFinite(e)&&!this.intersects(t[this.dimension]-e,2*e))return;const i=e=>Math.abs(e[this.dimension]-t[this.dimension]),n=this.getIndex(t);if(-1==n){let n,r=e;for(const e of this.items){if(e===t)continue;const o=i(e);o<r&&(r=o,n=e)}return n}let r=this.nodes[n].find(t,e),o=r?i(r):1/0;for(const e of this.nodes){if(e===this.nodes[n])continue;const a=e.find(t,o);if(!a)continue;const s=i(a);s<o&&(o=s,r=a)}return r},getIndex:function(t){if(!this.nodes.length)return-1;const e=this.minValue+this.range/2;return t[this.dimension]<=e?0:1},insert:function(t={}){if(!(this.dimension in t))return this;const e=this.getIndex(t);return-1!=e?(this.nodes[e].insert(t),this):(this.items.push(t),this.items.length>this.maxItems&&this.split(),this)},intersects:function(e,i){return t.utility.between(this.minValue,e,e+i)||t.utility.between(e,this.minValue,this.minValue+this.range)},remove:function(t){if(this.nodes.length){const e=this.getIndex(t);return this.nodes[e].remove(t),this}const e=this.items.indexOf(t);return-1!=e&&this.items.splice(e,1),this},retrieve:function(t,e){const i=[];if(!this.intersects(t,e))return i;for(const n of this.items)n[this.dimension]>=t&&n[this.dimension]<=t+e&&i.push(n);for(const n of this.nodes)i.push(...n.retrieve(t,e));return i},split:function(){if(this.nodes.length)return this;const e=this.range/2;this.nodes[0]=t.utility.bitree.create({dimension:this.dimension,maxItems:this.maxItems,minValue:this.minValue,range:e}),this.nodes[1]=t.utility.bitree.create({dimension:this.dimension,maxItems:this.maxItems,minValue:this.minValue+e,range:e});for(const t of this.items){const e=this.getIndex(t);this.nodes[e].insert(t)}return this.items.length=0,this}},t.utility.euler={},t.utility.euler.create=function(t={}){return Object.create(this.prototype).construct(t)},t.utility.euler.fromQuaternion=function({w:e=0,x:i=0,y:n=0,z:r=0}={},o=t.const.eulerToQuaternion){const a=e**2,s=e*i,u=e*n,c=e*r,h=i**2,l=i*n,d=i*r,y=n**2,f=n*r,p=r**2;switch(o){case"XYZ":return this.create({pitch:Math.asin(2*(d+u)),roll:Math.atan2(-2*(f-s),a-h-y+p),yaw:Math.atan2(-2*(l-c),a+h-y-p)});case"XZY":return this.create({pitch:Math.atan2(2*(d+u),a+h-y-p),roll:Math.atan2(2*(f+s),a-h+y-p),yaw:Math.asin(-2*(l-c))});case"YXZ":return this.create({pitch:Math.atan2(2*(d+u),a-h-y+p),roll:Math.asin(-2*(f-s)),yaw:Math.atan2(2*(l+c),a-h+y-p)});case"YZX":return this.create({pitch:Math.atan2(-2*(d-u),a+h-y-p),roll:Math.atan2(-2*(f-s),a-h+y-p),yaw:Math.asin(2*(l+c))});case"ZXY":return this.create({pitch:Math.atan2(-2*(d-u),a-h-y+p),roll:Math.asin(2*(f+s)),yaw:Math.atan2(-2*(l-c),a-h+y-p)});case"ZYX":return this.create({pitch:Math.asin(-2*(d-u)),roll:Math.atan2(2*(f+s),a-h-y+p),yaw:Math.atan2(2*(l+c),a+h-y-p)})}},t.utility.euler.prototype={clone:function(){return t.utility.euler.create(this)},construct:function({pitch:t=0,roll:e=0,yaw:i=0}={}){return this.pitch=t,this.roll=e,this.yaw=i,this},equals:function({pitch:t=0,roll:e=0,yaw:i=0}={}){return this.pitch==t&&this.roll==e&&this.yaw==i},forward:function(){return t.utility.vector3d.unitX().rotateEuler(this)},isZero:function(){return!this.pitch&&!this.roll&&!this.yaw},pitch:0,right:function(){return t.utility.vector3d.unitY().rotateEuler(this)},roll:0,scale:function(e=0){return t.utility.euler.create({pitch:this.pitch*e,roll:this.roll*e,yaw:this.yaw*e})},set:function({pitch:t=0,roll:e=0,yaw:i=0}={}){return this.pitch=t,this.roll=e,this.yaw=i,this},up:function(){return t.utility.vector3d.unitZ().rotateEuler(this)},yaw:0},t.utility.machine={},t.utility.machine.create=function(t={}){return Object.create(this.prototype).construct(t)},t.utility.machine.prototype={change:function(t,e={}){if(!(t in this.transition)||this.is(t))return this;const i={currentState:this.state,nextState:t,...e};this.pubsub.emit("exit",i),this.pubsub.emit(`exit-${this.state}`,i);const n={currentState:t,previousState:this.state,...e};return this.setState(t),this.pubsub.emit("enter",n),this.pubsub.emit(`enter-${this.state}`,n),this},construct:function({state:e="none",transition:i={}}={}){return this.transition={...i},this.setState(e),t.utility.pubsub.decorate(this),this},destroy:function(){return this.pubsub.destroy(),this},dispatch:function(t,e={}){const i=this.transition[this.state];if(!i)return this;const n=i[t];if(n){const i=this.state,r={event:t,state:i,...e};this.pubsub.emit("before",r),this.pubsub.emit(`before-${t}`,r),this.pubsub.emit(`before-${i}-${t}`,r),n.call(this,e);const o={currentState:this.state,event:t,previousState:i,...e};this.pubsub.emit("after",o),this.pubsub.emit(`after-${t}`,o),this.pubsub.emit(`after-${i}-${t}`,o)}return this},getState:function(){return this.state},is:function(t){return this.state==t},setState:function(t){return t in this.transition&&(this.state=t),this},state:void 0},t.utility.octree={},t.utility.octree.create=function(t={}){return Object.create(this.prototype).construct(t)},t.utility.octree.from=function(t=[],e={}){const i=this.create(e);for(const e of t)i.insert(e);return i},t.utility.octree.prototype={clear:function(){return this.items.length=0,this.nodes.length=0,this},construct:function({depth:e=2*t.const.maxSafeFloat,height:i=2*t.const.maxSafeFloat,maxItems:n=12,width:r=2*t.const.maxSafeFloat,x:o=-t.const.maxSafeFloat,y:a=-t.const.maxSafeFloat,z:s=-t.const.maxSafeFloat}={}){return this.depth=e,this.height=i,this.items=[],this.maxItems=n,this.nodes=[],this.width=r,this.x=o,this.y=a,this.z=s,this},destroy:function(){return this.clear()},find:function(t={},e=1/0){if(!("x"in t&&"y"in t&&"z"in t))return;if(isFinite(e)&&!this.intersects({depth:2*e,height:2*e,width:2*e,x:t.x-e,y:t.y-e,z:t.z-e}))return;const i=({x:e,y:i,z:n})=>(e-t.x)**2+(i-t.y)**2+(n-t.z)**2,n=this.getIndex(t),r=(e*(Math.sqrt(3)/3))**2*3;if(-1==n){let e,n=r;for(const r of this.items){if(r===t)continue;const o=i(r);o<n&&(n=o,e=r)}return e}let o=this.nodes[n].find(t,e),a=o?i(o):r;for(const e of this.nodes){if(e===this.nodes[n])continue;const r=e.find(t,a);if(!r||r===t)continue;const s=i(r);s<a&&(a=s,o=r)}return o},getIndex:function({x:t=0,y:e=0,z:i=0}={}){if(!this.nodes.length)return-1;const n=t<=this.x+this.width/2,r=e<=this.y+this.height/2;return i<=this.z+this.depth/2?n&&r?0:!n&&r?1:n&&!r?2:3:n&&r?4:!n&&r?5:n&&!r?6:7},insert:function(t={}){if(!("x"in t&&"y"in t&&"z"in t))return this;const e=this.getIndex(t);return-1!=e?(this.nodes[e].insert(t),this):(this.items.push(t),this.items.length>this.maxItems&&this.split(),this)},intersects:function(e){return t.utility.intersects(this,e)},remove:function(t){if(this.nodes.length){const e=this.getIndex(t);return this.nodes[e].remove(t),this}const e=this.items.indexOf(t);return-1!=e&&this.items.splice(e,1),this},retrieve:function({depth:t=0,height:e=0,width:i=0,x:n=0,y:r=0,z:o=0}={}){const a=[];if(!this.intersects({depth:t,height:e,width:i,x:n,y:r,z:o}))return a;for(const s of this.items)s.x>=n&&s.x<=n+i&&s.y>=r&&s.y<=r+e&&s.z>=o&&s.z<=o+t&&a.push(s);for(const s of this.nodes)a.push(...s.retrieve({depth:t,height:e,width:i,x:n,y:r,z:o}));return a},split:function(){if(this.nodes.length)return this;const e=this.depth/2,i=this.height/2,n=this.width/2;this.nodes[0]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x,y:this.y,z:this.z}),this.nodes[1]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x+n,y:this.y,z:this.z}),this.nodes[2]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x,y:this.y+i,z:this.z}),this.nodes[3]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x+n,y:this.y+i,z:this.z}),this.nodes[4]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x,y:this.y,z:this.z+e}),this.nodes[5]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x+n,y:this.y,z:this.z+e}),this.nodes[6]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x,y:this.y+i,z:this.z+e}),this.nodes[7]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x+n,y:this.y+i,z:this.z+e});for(const t of this.items){const e=this.getIndex(t);this.nodes[e].insert(t)}return this.items.length=0,this}},t.utility.perlin1d={},t.utility.perlin1d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.perlin1d.prototype={construct:function(...t){return this.gradient=new Map,this.seed=t,this},generateGradient:function(e){return t.utility.srand("perlin",...this.seed,e)(0,1)},getGradient:function(t){let e=this.gradient.get(t);return e||(e=this.generateGradient(t),this.gradient.set(t,e)),e},reset:function(){return this.gradient.clear(),this},smooth:function(t){return t**3*(t*(6*t-15)+10)},value:function(e){const i=Math.floor(e),n=i+1,r=this.smooth(e-i),o=this.getGradient(i),a=this.getGradient(n);return t.utility.clamp(t.utility.lerp(o,a,r),0,1)}},t.utility.perlin2d={},t.utility.perlin2d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.perlin2d.prototype={construct:function(...t){return this.gradient=new Map,this.seed=t,this},generateGradient:function(e,i){const n=t.utility.srand("perlin",...this.seed,e,i);return[n(-1,1),n(-1,1)]},getDotProduct:function(t,e,i,n){const r=i-t,o=n-e,a=this.getGradient(t,e);return r*a[0]+o*a[1]},getGradient:function(t,e){let i=this.gradient.get(t);i||(i=new Map,this.gradient.set(t,i));let n=i.get(e);return n||(n=this.generateGradient(t,e),i.set(e,n)),n},range:Math.sqrt(.5),reset:function(){return this.gradient.clear(),this},smooth:function(t){return t**3*(t*(6*t-15)+10)},value:function(e,i){const n=Math.floor(e),r=n+1,o=Math.floor(i),a=o+1,s=this.smooth(e-n),u=this.smooth(i-o),c=t.utility.lerp(t.utility.lerp(this.getDotProduct(n,o,e,i),this.getDotProduct(r,o,e,i),s),t.utility.lerp(this.getDotProduct(n,a,e,i),this.getDotProduct(r,a,e,i),s),u);return t.utility.clamp(t.utility.scale(c,-this.range,this.range,0,1),0,1)}},t.utility.perlin3d={},t.utility.perlin3d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.perlin3d.prototype={construct:function(...t){return this.gradient=new Map,this.seed=t,this},generateGradient:function(e,i,n){const r=t.utility.srand("perlin",...this.seed,e,i,n);return[r(-1,1),r(-1,1),r(-1,1)]},getDotProduct:function(t,e,i,n,r,o){const a=n-t,s=r-e,u=o-i,c=this.getGradient(t,e,i);return a*c[0]+s*c[1]+u*c[2]},getGradient:function(t,e,i){let n=this.gradient.get(t);n||(n=new Map,this.gradient.set(t,n));let r=n.get(e);r||(r=new Map,n.set(e,r));let o=r.get(i);return o||(o=this.generateGradient(t,e,i),r.set(i,o)),o},range:Math.sqrt(3/4),reset:function(){return this.gradient.clear(),this},smooth:function(t){return t**3*(t*(6*t-15)+10)},value:function(e,i,n){const r=Math.floor(e),o=r+1,a=Math.floor(i),s=a+1,u=Math.floor(n),c=u+1,h=this.smooth(e-r),l=this.smooth(i-a),d=this.smooth(n-u),y=t.utility.lerp(t.utility.lerp(t.utility.lerp(this.getDotProduct(r,a,u,e,i,n),this.getDotProduct(o,a,u,e,i,n),h),t.utility.lerp(this.getDotProduct(r,s,u,e,i,n),this.getDotProduct(o,s,u,e,i,n),h),l),t.utility.lerp(t.utility.lerp(this.getDotProduct(r,a,c,e,i,n),this.getDotProduct(o,a,c,e,i,n),h),t.utility.lerp(this.getDotProduct(r,s,c,e,i,n),this.getDotProduct(o,s,c,e,i,n),h),l),d);return t.utility.clamp(t.utility.scale(y,-this.range,this.range,0,1),0,1)}},t.utility.perlin4d={},t.utility.perlin4d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.perlin4d.prototype={construct:function(...t){return this.gradient=new Map,this.seed=t,this},generateGradient:function(e,i,n,r){const o=t.utility.srand("perlin",...this.seed,e,i,n,r);return[o(-1,1),o(-1,1),o(-1,1),o(-1,1)]},getDotProduct:function(t,e,i,n,r,o,a,s){const u=s-n,c=r-t,h=o-e,l=a-i,d=this.getGradient(t,e,i,n);return c*d[0]+h*d[1]+l*d[2]+u*d[3]},getGradient:function(t,e,i,n){let r=this.gradient.get(t);r||(r=new Map,this.gradient.set(t,r));let o=r.get(e);o||(o=new Map,r.set(e,o));let a=o.get(i);a||(a=new Map,o.set(i,a));let s=a.get(n);return s||(s=this.generateGradient(t,e,i,n),a.set(n,s)),s},range:Math.sqrt(1),reset:function(){return this.gradient.clear(),this},smooth:function(t){return t**3*(t*(6*t-15)+10)},value:function(e,i,n,r){const o=Math.floor(r),a=o+1,s=Math.floor(e),u=s+1,c=Math.floor(i),h=c+1,l=Math.floor(n),d=l+1,y=this.smooth(r-o),f=this.smooth(e-s),p=this.smooth(i-c),m=this.smooth(n-l),g=t.utility.lerp(t.utility.lerp(t.utility.lerp(t.utility.lerp(this.getDotProduct(s,c,l,o,e,i,n,r),this.getDotProduct(u,c,l,o,e,i,n,r),f),t.utility.lerp(this.getDotProduct(s,h,l,o,e,i,n,r),this.getDotProduct(u,h,l,o,e,i,n,r),f),p),t.utility.lerp(t.utility.lerp(this.getDotProduct(s,c,d,o,e,i,n,r),this.getDotProduct(u,c,d,o,e,i,n,r),f),t.utility.lerp(this.getDotProduct(s,h,d,o,e,i,n,r),this.getDotProduct(u,h,d,o,e,i,n,r),f),p),m),t.utility.lerp(t.utility.lerp(t.utility.lerp(this.getDotProduct(s,c,l,a,e,i,n,r),this.getDotProduct(u,c,l,a,e,i,n,r),f),t.utility.lerp(this.getDotProduct(s,h,l,a,e,i,n,r),this.getDotProduct(u,h,l,a,e,i,n,r),f),p),t.utility.lerp(t.utility.lerp(this.getDotProduct(s,c,d,a,e,i,n,r),this.getDotProduct(u,c,d,a,e,i,n,r),f),t.utility.lerp(this.getDotProduct(s,h,d,a,e,i,n,r),this.getDotProduct(u,h,d,a,e,i,n,r),f),p),m),y);return t.utility.clamp(t.utility.scale(g,-this.range,this.range,0,1),0,1)}},t.utility.physical={},t.utility.physical.decorate=function(e={}){return e.x||(e.x=0),e.y||(e.y=0),e.z||(e.z=0),e.angularVelocity=t.utility.quaternion.create(),e.quaternion=t.utility.quaternion.create(),e.velocity=t.utility.vector3d.create(),Object.keys(this.decoration).forEach(t=>{e[t]=this.decoration[t]}),e},t.utility.physical.decoration={euler:function(){return t.utility.euler.fromQuaternion(this.quaternion)},resetPhysics:function(){return this.angularVelocity.set({w:1}),this.velocity.set(),this},updatePhysics:function(e=t.loop.delta()){return e<=0||isNaN(e)||!isFinite(e)||(this.angularVelocity.isZero()||(this.quaternion=this.quaternion.multiply(this.angularVelocity.lerpFrom({w:1},e))),this.velocity.isZero()||(this.x+=this.velocity.x*e,this.y+=this.velocity.y*e,this.z+=this.velocity.z*e)),this},vector:function(){return t.utility.vector3d.create(this)}},t.utility.pubsub={},t.utility.pubsub.create=function(){return Object.create(this.prototype).construct()},t.utility.pubsub.decorate=function(t,e){return this.prototype.isPrototypeOf(e)||(e=this.create(),t.pubsub=e),["emit","off","on","once"].forEach(i=>{t[i]=function(...t){return e[i](...t),this}}),t},t.utility.pubsub.prototype={construct:function(){return this._handler={},this},destroy:function(){return this.off(),this},emit:function(t,...e){if(!this._handler[t])return this;return[...this._handler[t]].forEach(t=>t(...e)),this},off:function(t,e){if(void 0===t)return this._handler={},this;if(void 0===e)return delete this._handler[t],this;if(!this._handler[t])return this;const i=this._handler[t],n=i.indexOf(e);return-1!=n&&i.splice(n,1),this},on:function(t,e){return e instanceof Function?(this._handler[t]||(this._handler[t]=[]),this._handler[t].push(e),this):this},once:function(t,e){const i=(...n)=>{this.off(t,i),e(...n)};return this.on(t,i)}},t.utility.quadtree={},t.utility.quadtree.create=function(t={}){return Object.create(this.prototype).construct(t)},t.utility.quadtree.from=function(t=[],e={}){const i=this.create(e);for(const e of t)i.insert(e);return i},t.utility.quadtree.prototype={clear:function(){return this.items.length=0,this.nodes.length=0,this},construct:function({height:e=2*t.const.maxSafeFloat,maxItems:i=12,width:n=2*t.const.maxSafeFloat,x:r=-t.const.maxSafeFloat,y:o=-t.const.maxSafeFloat}={}){return this.height=e,this.items=[],this.maxItems=i,this.nodes=[],this.width=n,this.x=r,this.y=o,this},destroy:function(){return this.clear()},find:function(t={},e=1/0){if(!("x"in t)||!("y"in t))return;if(isFinite(e)&&!this.intersects({height:2*e,width:2*e,x:t.x-e,y:t.y-e}))return;const i=({x:e,y:i})=>(e-t.x)**2+(i-t.y)**2,n=this.getIndex(t),r=(e*(Math.sqrt(2)/2))**2*2;if(-1==n){let e,n=r;for(const r of this.items){if(r===t)continue;const o=i(r);o<n&&(n=o,e=r)}return e}let o=this.nodes[n].find(t,e),a=o?i(o):r;for(const e of this.nodes){if(e===this.nodes[n])continue;const r=e.find(t,a);if(!r)continue;const s=i(r);s<a&&(a=s,o=r)}return o},getIndex:function({x:t=0,y:e=0}={}){if(!this.nodes.length)return-1;const i=this.x+this.width/2,n=this.y+this.height/2;return t<=i&&e<=n?0:t>=i&&e<=n?1:t<=i&&e>=n?2:3},insert:function(t={}){if(!("x"in t)||!("y"in t))return this;const e=this.getIndex(t);return-1!=e?(this.nodes[e].insert(t),this):(this.items.push(t),this.items.length>this.maxItems&&this.split(),this)},intersects:function(e){return t.utility.intersects(this,e)},remove:function(t){if(this.nodes.length){const e=this.getIndex(t);return this.nodes[e].remove(t),this}const e=this.items.indexOf(t);return-1!=e&&this.items.splice(e,1),this},retrieve:function({height:t=0,width:e=0,x:i=0,y:n=0}={}){const r=[];if(!this.intersects({height:t,width:e,x:i,y:n}))return r;for(const o of this.items)o.x>=i&&o.x<=i+e&&o.y>=n&&o.y<=n+t&&r.push(o);for(const o of this.nodes)r.push(...o.retrieve({height:t,width:e,x:i,y:n}));return r},split:function(){if(this.nodes.length)return this;const e=this.height/2,i=this.width/2;this.nodes[0]=t.utility.quadtree.create({height:e,maxItems:this.maxItems,width:i,x:this.x,y:this.y}),this.nodes[1]=t.utility.quadtree.create({height:e,maxItems:this.maxItems,width:i,x:this.x+i,y:this.y}),this.nodes[2]=t.utility.quadtree.create({height:e,maxItems:this.maxItems,width:i,x:this.x,y:this.y+e}),this.nodes[3]=t.utility.quadtree.create({height:e,maxItems:this.maxItems,width:i,x:this.x+i,y:this.y+e});for(const t of this.items){const e=this.getIndex(t);this.nodes[e].insert(t)}return this.items.length=0,this}},t.utility.quaternion={},t.utility.quaternion.create=function(t={}){return Object.create(this.prototype).construct(t)},t.utility.quaternion.fromEuler=function({pitch:e=0,roll:i=0,yaw:n=0}={},r=t.const.eulerToQuaternion){r=r.toUpperCase();const o=i/2,a=e/2,s=n/2,u=Math.cos(o),c=Math.cos(a),h=Math.cos(s),l=Math.sin(o),d=Math.sin(a),y=Math.sin(s);switch(r){case"XYZ":return this.create({w:u*c*h-l*d*y,x:l*c*h+u*d*y,y:u*d*h-l*c*y,z:u*c*y+l*d*h});case"XZY":return this.create({w:u*c*h+l*d*y,x:l*c*h-u*d*y,y:u*d*h-l*c*y,z:u*c*y+l*d*h});case"YXZ":return this.create({w:u*c*h+l*d*y,x:l*c*h+u*d*y,y:u*d*h-l*c*y,z:u*c*y-l*d*h});case"YZX":return this.create({w:u*c*h-l*d*y,x:l*c*h+u*d*y,y:u*d*h+l*c*y,z:u*c*y-l*d*h});case"ZXY":return this.create({w:u*c*h-l*d*y,x:l*c*h-u*d*y,y:u*d*h+l*c*y,z:u*c*y+l*d*h});case"ZYX":return this.create({w:u*c*h+l*d*y,x:l*c*h-u*d*y,y:u*d*h+l*c*y,z:u*c*y-l*d*h})}},t.utility.quaternion.prototype={clone:function(){return t.utility.quaternion.create(this)},conjugate:function(){return t.utility.quaternion.create({w:this.w,x:-this.x,y:-this.y,z:-this.z})},construct:function({w:t=1,x:e=0,y:i=0,z:n=0}={}){return this.w=t,this.x=e,this.y=i,this.z=n,this},distance:function(){return Math.sqrt(this.w**2+this.x**2+this.y**2+this.z**2)},distance2:function(){return this.w**2+this.x**2+this.y**2+this.z**2},divide:function(e){return t.utility.quaternion.prototype.isPrototypeOf(quaternion)||(quaternion=t.utility.quaternion.create(quaternion)),this.multiply(quaternion.inverse())},equals:function({w:t=1,x:e=0,y:i=0,z:n=0}={}){return this.w==t&&this.x==e&&this.y==i&&this.z==n},forward:function(){return t.utility.vector3d.unitX().rotateQuaternion(this)},inverse:function(){const t=1/this.distance2();return isFinite(t)?this.conjugate().scale(t):this.conjugate()},isZero:function(){return 1==this.w&&!this.x&&!this.y&&!this.z},lerpFrom:function({w:e=1,x:i=0,y:n=0,z:r=0}={},o=0){return t.utility.quaternion.create({w:t.utility.lerp(e,this.w,o),x:t.utility.lerp(i,this.x,o),y:t.utility.lerp(n,this.y,o),z:t.utility.lerp(r,this.z,o)})},lerpTo:function({w:e=1,x:i=0,y:n=0,z:r=0}={},o=0){return t.utility.quaternion.create({w:t.utility.lerp(this.w,e,o),x:t.utility.lerp(this.x,i,o),y:t.utility.lerp(this.y,n,o),z:t.utility.lerp(this.z,r,o)})},multiply:function({w:e=1,x:i=0,y:n=0,z:r=0}={}){return t.utility.quaternion.create({w:this.w*e-this.x*i-this.y*n-this.z*r,x:this.w*i+this.x*e+this.y*r-this.z*n,y:this.w*n+this.y*e+this.z*i-this.x*r,z:this.w*r+this.z*e+this.x*n-this.y*i})},normalize:function(){const t=this.distance();return t?this.scale(1/t):this.clone()},right:function(){return t.utility.vector3d.unitY().rotateQuaternion(this)},scale:function(e=0){return t.utility.quaternion.create({w:this.w*e,x:this.x*e,y:this.y*e,z:this.z*e})},set:function({w:t=1,x:e=0,y:i=0,z:n=0}={}){return this.w=t,this.x=e,this.y=i,this.z=n,this},up:function(){return t.utility.vector3d.unitZ().rotateQuaternion(this)},w:1,x:0,y:0,z:0},t.utility.quaternion.identity=function(){return Object.create(this.prototype).construct({w:1})},t.utility.random={},t.utility.random.float=(t=0,e=1)=>t+Math.random()*(e-t),t.utility.random.integer=function(t=0,e=1){return Math.round(this.float(t,e))},t.utility.random.sign=()=>Math.random()<.5?1:-1,t.utility.random.key=function(t){const e=t instanceof Map?[...t.keys()]:Object.keys(t);return e[this.integer(0,e.length-1)]},t.utility.random.value=function(t){t instanceof Set&&(t=[...t.values()]);const e=this.key(t);return t instanceof Map?t.get(e):t[e]},t.utility.simplex2d={},t.utility.simplex2d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.simplex2d.prototype={construct:function(...t){return this.gradient=new Map,this.seed=t,this},generateGradient:function(e,i){const n=t.utility.srand("simplex",...this.seed,e,i);let r=n(-1,1),o=n(-1,1);const a=Math.sqrt(r*r+o*o);return a>1&&(r/=a,o/=a),[r,o]},getGradient:function(t,e){let i=this.gradient.get(t);i||(i=new Map,this.gradient.set(t,i));let n=i.get(e);return n||(n=this.generateGradient(t,e),i.set(e,n)),n},range:1/99,reset:function(){return this.gradient.clear(),this},skewFactor:(Math.sqrt(3)-1)/2,unskewFactor:(3-Math.sqrt(3))/6,value:function(e,i){const n=this.skewFactor,r=this.unskewFactor,o=(e+i)*n,a=Math.floor(e+o),s=Math.floor(i+o),u=(a+s)*r,c=e-(a-u),h=i-(s-u),l=c>h?1:0,d=c>h?0:1,y=c-l+r,f=h-d+r,p=c-1+2*r,m=h-1+2*r,g=.5-c*c-h*h;let x=0;if(g>=0){const t=this.getGradient(a,s);x=g*g*g*g*(t[0]*c+t[1]*h)}const v=.5-y*y-f*f;let w=0;if(v>=0){const t=this.getGradient(a+l,s+d);w=v*v*v*v*(t[0]*y+t[1]*f)}const b=.5-p*p-m*m;let q=0;if(b>=0){const t=this.getGradient(a+1,s+1);q=b*b*b*b*(t[0]*p+t[1]*m)}return t.utility.clamp(t.utility.scale(x+w+q,-this.range,this.range,0,1),0,1)}},t.utility.simplex3d={},t.utility.simplex3d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.simplex3d.prototype={construct:function(...t){return this.gradient=new Map,this.seed=t,this},generateGradient:function(e,i,n){const r=t.utility.srand("simplex",...this.seed,e,i,n);let o=r(-1,1),a=r(-1,1),s=r(-1,1);const u=Math.sqrt(o*o+a*a+s*s);return u>1&&(o/=u,a/=u,s/=u),[o,a,s]},getGradient:function(t,e,i){let n=this.gradient.get(t);n||(n=new Map,this.gradient.set(t,n));let r=n.get(e);r||(r=new Map,n.set(e,r));let o=r.get(i);return o||(o=this.generateGradient(t,e,i),r.set(i,o)),o},range:1/107,reset:function(){return this.gradient.clear(),this},skewFactor:1/3,unskewFactor:1/6,value:function(e,i,n){const r=this.skewFactor,o=this.unskewFactor,a=(e+i+n)*r,s=Math.floor(e+a),u=Math.floor(i+a),c=Math.floor(n+a),h=(s+u+c)*o,l=e-(s-h),d=i-(u-h),y=n-(c-h);let f,p,m,g,x,v;l>=d?d>=y?(f=1,p=0,m=0,g=1,x=1,v=0):l>=y?(f=1,p=0,m=0,g=1,x=0,v=1):(f=0,p=0,m=1,g=1,x=0,v=1):d<y?(f=0,p=0,m=1,g=0,x=1,v=1):l<y?(f=0,p=1,m=0,g=0,x=1,v=1):(f=0,p=1,m=0,g=1,x=1,v=0);const w=l-f+o,b=d-p+o,q=y-m+o,z=l-g+2*o,M=d-x+2*o,G=y-v+2*o,P=l-1+3*o,S=d-1+3*o,D=y-1+3*o,F=.5-l*l-d*d-y*y;let A=0;if(F>=0){const t=this.getGradient(s,u,c);A=F*F*F*F*(t[0]*l+t[1]*d+t[2]*y)}const I=.5-w*w-b*b-q*q;let O=0;if(I>=0){const t=this.getGradient(s+f,u+p,c+m);O=I*I*I*I*(t[0]*w+t[1]*b+t[2]*q)}const T=.5-z*z-M*M-G*G;let k=0;if(T>=0){const t=this.getGradient(s+g,u+x,c+v);k=T*T*T*T*(t[0]*z+t[1]*M+t[2]*G)}const E=.5-P*P-S*S-D*D;let R=0;if(E>=0){const t=this.getGradient(s+1,u+1,c+1);R=E*E*E*E*(t[0]*P+t[1]*S+t[2]*D)}return t.utility.clamp(t.utility.scale(A+O+k+R,-this.range,this.range,0,1),0,1)}},t.utility.simplex4d={},t.utility.simplex4d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.simplex4d.prototype={construct:function(...t){return this.gradient=new Map,this.seed=t,this},generateGradient:function(e,i,n,r){const o=t.utility.srand("simplex",...this.seed,e,i,n,r);let a=o(-1,1),s=o(-1,1),u=o(-1,1),c=o(-1,1);const h=Math.sqrt(a*a+s*s+u*u+c*c);return h>1&&(a/=h,s/=h,u/=h,c/=h),[a,s,u,c]},getGradient:function(t,e,i,n){let r=this.gradient.get(t);r||(r=new Map,this.gradient.set(t,r));let o=r.get(e);o||(o=new Map,r.set(e,o));let a=o.get(i);a||(a=new Map,o.set(i,a));let s=a.get(n);return s||(s=this.generateGradient(t,e,i,n),a.set(n,s)),s},range:1/108,reset:function(){return this.gradient.clear(),this},skewFactor:(Math.sqrt(5)-1)/4,unskewFactor:(5-Math.sqrt(5))/20,value:function(e,i,n,r){const o=this.skewFactor,a=this.unskewFactor,s=(e+i+n+r)*o,u=Math.floor(e+s),c=Math.floor(i+s),h=Math.floor(n+s),l=Math.floor(r+s),d=(u+c+h+l)*a,y=e-(u-d),f=i-(c-d),p=n-(h-d),m=r-(l-d);let g=0,x=0,v=0,w=0;y>f?g++:x++,y>p?g++:v++,y>m?g++:w++,f>p?x++:v++,f>m?x++:w++,p>m?v++:w++;const b=g>=3?1:0,q=x>=3?1:0,z=v>=3?1:0,M=w>=3?1:0,G=g>=2?1:0,P=x>=2?1:0,S=v>=2?1:0,D=w>=2?1:0,F=g>=1?1:0,A=x>=1?1:0,I=v>=1?1:0,O=w>=1?1:0,T=y-b+a,k=f-q+a,E=p-z+a,R=m-M+a,Q=y-G+2*a,j=f-P+2*a,X=p-S+2*a,Y=m-D+2*a,V=y-F+3*a,Z=f-A+3*a,C=p-I+3*a,L=m-O+3*a,B=y-1+4*a,_=f-1+4*a,W=p-1+4*a,N=m-1+4*a,U=.5-y*y-f*f-p*p-m*m;let $=0;if(U>=0){const t=this.getGradient(u,c,h,l);$=U*U*U*U*(t[0]*y+t[1]*f+t[2]*p+t[3]*m)}const H=.5-T*T-k*k-E*E-R*R;let J=0;if(H>=0){const t=this.getGradient(u+b,c+q,h+z,l+M);J=H*H*H*H*(t[0]*T+t[1]*k+t[2]*E+t[3]*R)}const K=.5-Q*Q-j*j-X*X-Y*Y;let tt=0;if(K>=0){const t=this.getGradient(u+G,c+P,h+S,l+D);tt=K*K*K*K*(t[0]*Q+t[1]*j+t[2]*X+t[3]*Y)}const et=.5-V*V-Z*Z-C*C-L*L;let it=0;if(et>=0){const t=this.getGradient(u+F,c+A,h+I,l+O);it=et*et*et*et*(t[0]*V+t[1]*Z+t[2]*C+t[3]*L)}const nt=.5-B*B-_*_-W*W-N*N;let rt=0;if(nt>=0){const t=this.getGradient(u+1,c+1,h+1,l+1);rt=nt*nt*nt*nt*(t[0]*B+t[1]*_+t[2]*W+t[3]*N)}return t.utility.clamp(t.utility.scale($+J+tt+it+rt,-this.range,this.range,0,1),0,1)}},t.utility.timing={},t.utility.timing.cancelablePromise=t=>{const e={},i=new Promise((t,i)=>{e.reject=i,e.resolve=t}),n=setTimeout(e.resolve,t);return i.cancel=function(){return e.reject(),clearTimeout(n),this},i.catch(()=>{}),i},t.utility.timing.promise=t=>new Promise(e=>setTimeout(e,t)),t.utility.vector2d={},t.utility.vector2d.create=function(t={}){return Object.create(this.prototype).construct(t)},t.utility.vector2d.prototype={add:function({x:e=0,y:i=0}={}){return t.utility.vector2d.create({x:this.x+e,y:this.y+i})},angle:function(){return Math.atan2(this.y,this.x)},clone:function(){return t.utility.vector2d.create(this)},construct:function({x:t=0,y:e=0}={}){return this.x=t,this.y=e,this},crossProduct:function({x:t=0,y:e=0}={}){return this.x*e-this.y*t},distance:function({x:t=0,y:e=0}={}){return Math.sqrt((this.x-t)**2+(this.y-e)**2)},distance2:function({x:t=0,y:e=0}={}){return(this.x-t)**2+(this.y-e)**2},dotProduct:function({x:t=0,y:e=0}={}){return this.x*t+this.y*e},equals:function({x:t=0,y:e=0}={}){return this.x==t&&this.y==e},inverse:function(){return t.utility.vector2d.create({x:-this.x,y:-this.y})},isZero:function(){return!this.x&&!this.y},normalize:function(){const t=this.distance();return t?this.scale(1/t):this.clone()},rotate:function(e=0){if(0==e)return this.clone();const i=Math.cos(e),n=Math.sin(e);return t.utility.vector2d.create({x:this.x*i-this.y*n,y:this.y*i+this.x*n})},scale:function(e=0){return t.utility.vector2d.create({x:this.x*e,y:this.y*e})},set:function({x:t=0,y:e=0}={}){return this.x=t,this.y=e,this},subtract:function({x:e=0,y:i=0}={}){return t.utility.vector2d.create({x:this.x-e,y:this.y-i})},subtractRadius:function(e=0){if(e<=0)return this.clone();const i=this.distance();return e>=i?t.utility.vector2d.create():this.multiply(1-e/i)},x:0,y:0},t.utility.vector2d.unitX=function(){return Object.create(this.prototype).construct({x:1})},t.utility.vector2d.unitY=function(){return Object.create(this.prototype).construct({y:1})},t.utility.vector3d={},t.utility.vector3d.create=function(t={}){return Object.create(this.prototype).construct(t)},t.utility.vector3d.prototype={add:function({x:e=0,y:i=0,z:n=0}={}){return t.utility.vector3d.create({x:this.x+e,y:this.y+i,z:this.z+n})},clone:function(){return t.utility.vector3d.create(this)},construct:function({x:t=0,y:e=0,z:i=0}={}){return this.x=t,this.y=e,this.z=i,this},crossProduct:function({x:e=0,y:i=0,z:n=0}={}){return t.utility.vector3d.create({x:this.y*n-this.z*i,y:this.z*e-this.x*n,z:this.x*i-this.y*e})},distance:function({x:t=0,y:e=0,z:i=0}={}){return Math.sqrt((this.x-t)**2+(this.y-e)**2+(this.z-i)**2)},distance2:function({x:t=0,y:e=0,z:i=0}={}){return(this.x-t)**2+(this.y-e)**2+(this.z-i)**2},dotProduct:function({x:t=0,y:e=0,z:i=0}={}){return this.x*t+this.y*e+this.z*i},equals:function({x:t=0,y:e=0,z:i=0}={}){return this.x==t&&this.y==e&&this.z==i},euler:function(){return t.utility.euler.create({pitch:this.z?Math.atan2(this.z,Math.sqrt(this.x**2+this.y**2)):0,roll:0,yaw:Math.atan2(this.y,this.x)})},inverse:function(){return t.utility.vector3d.create({x:-this.x,y:-this.y,z:-this.z})},isZero:function(){return!this.x&&!this.y&&!this.z},normalize:function(){const t=this.distance();return t?this.scale(1/t):this.clone()},quaternion:function(){return t.utility.quaternion.fromEuler(this.euler())},rotateEuler:function(e,i){return this.rotateQuaternion(t.utility.quaternion.fromEuler(e,i))},rotateQuaternion:function(e){return t.utility.quaternion.prototype.isPrototypeOf(e)||(e=t.utility.quaternion.create(e)),e.isZero()?this.clone():t.utility.vector3d.create(e.multiply(t.utility.quaternion.create(this)).multiply(e.inverse()))},scale:function(e=0){return t.utility.vector3d.create({x:this.x*e,y:this.y*e,z:this.z*e})},set:function({x:t=0,y:e=0,z:i=0}={}){return this.x=t,this.y=e,this.z=i,this},subtract:function({x:e=0,y:i=0,z:n=0}={}){return t.utility.vector3d.create({x:this.x-e,y:this.y-i,z:this.z-n})},subtractRadius:function(e=0){if(e<=0)return this.clone();const i=this.distance();return e>=i?t.utility.vector3d.create():this.scale(1-e/i)},x:0,y:0,z:0},t.utility.vector3d.unitX=function(){return Object.create(this.prototype).construct({x:1})},t.utility.vector3d.unitY=function(){return Object.create(this.prototype).construct({y:1})},t.utility.vector3d.unitZ=function(){return Object.create(this.prototype).construct({z:1})},t.const={acousticShadowFrequency:343/.1524,audioLookaheadTime:0,binauralHeadWidth:.1524,binauralShadowOffset:Math.PI/4,binauralShadowRolloff:1,distancePower:2,distancePowerHorizon:!1,distancePowerHorizonExponent:0,eulerToQuaternion:"ZYX",gravity:9.8,idleDelta:1/60,maxFrequency:2e4,maxSafeFloat:2**43-1,midiReferenceFrequency:440,midiReferenceNote:69,minFrequency:20,positionRadius:.25,speedOfSound:343,subFrequency:65.4064,tau:2*Math.PI,unit2:Math.sqrt(2)/2,unit3:Math.sqrt(3)/3,unit4:Math.sqrt(4)/4,zero:10**-32,zeroDb:-96,zeroGain:t.utility.fromDb(-96),zeroTime:.005},t.state=t.utility.pubsub.decorate({export:function(){const t={};return this.emit("export",t),t},import:function(t={}){return this.reset(),this.emit("import",t),this},reset:function(){return this.emit("reset"),this}}),t.seed=(()=>{let t,e="~";return{concat:(...i)=>(i.unshift(t),i.join(e)),get:()=>t,getSeparator:()=>e,set:function(e){return t=e,this},setSeparator:function(t){return"string"==typeof t&&(e=t),this},valueOf:()=>t}})(),t.state.on("export",(e={})=>e.seed=t.seed.get()),t.state.on("import",(e={})=>t.seed.set(e.seed)),t.state.on("reset",()=>t.seed.set()),t.audio=(()=>{const e=new AudioContext;return{buffer:{impulse:{},noise:{}},context:()=>e,nyquist:(t=1)=>t*e.sampleRate/2,start:function(){return e.resume(),this},stop:function(){return e.suspend(),this},time:(i=0)=>e.currentTime+t.const.audioLookaheadTime+i,zeroTime:()=>e.currentTime+t.const.audioLookaheadTime+t.const.zeroTime}})(),t.audio.binaural={},t.audio.binaural.create=function(t){return Object.create(this.prototype).construct(t)},t.audio.binaural.prototype={construct:function(e){const i=t.audio.context();return this.left=t.audio.binaural.monaural.create({pan:-1}),this.right=t.audio.binaural.monaural.create({pan:1}),this.merger=i.createChannelMerger(),this.left.to(this.merger,0,0),this.right.to(this.merger,0,1),this.update(e),this},destroy:function(){return this.left.destroy(),this.right.destroy(),this},from:function(t){return this.left.from(t),this.right.from(t),this},to:function(t){return this.merger.connect(t),this},update:function(t){return this.left.update(t),this.right.update(t),this}},t.audio.circuit={},t.audio.circuit.invert=({from:e,scale:i=1,to:n}={})=>{const r=t.audio.context().createGain();return r.gain.value=-Math.abs(i),e&&e.connect(r),n&&r.connect(n),r},t.audio.circuit.lerp=({chainStop:e,from:i,max:n=1,min:r=0,to:o,when:a}={})=>{const s=t.audio.context(),u=s.createGain(),c=s.createConstantSource(),h=s.createConstantSource();u.gain.value=0,c.offset.value=n-r,h.offset.value=r,o.value=0,i.connect(u.gain),c.connect(u),u.connect(o),h.connect(o),c.start(a),h.start(a);const l={stop:(e=t.audio.time())=>(c.stop(e),h.stop(e),this)};return e&&t.audio.synth.chainStop(e,l),l},t.audio.circuit.scale=({chainStop:e,from:i,fromMax:n=1,fromMin:r=0,to:o,toMax:a=1,toMin:s=0,when:u}={})=>{const c=t.audio.context(),h=c.createConstantSource(),l=c.createGain();h.offset.value=-r,l.gain.value=1/(n-r),h.connect(l),i&&i.connect(l),h.start(u);const d=t.audio.circuit.lerp({from:l,max:a,min:s,to:o,when:u}),y={stop:(e=t.audio.time())=>(d.stop(e),h.stop(e),this)};return e&&t.audio.synth.chainStop(e,y),y},t.audio.effect={},t.audio.effect.createDubDelay=function({delay:e=.5,dry:i=1,feedback:n=.5,filterDetune:r=0,filterFrequency:o=t.const.maxFrequency,filterGain:a=0,filterQ:s=1,filterType:u="lowpass",maxDelayTime:c=1,wet:h=.5}={}){const l=t.audio.context(),d=l.createDelay(c),y=l.createGain(),f=l.createGain(),p=l.createBiquadFilter(),m=l.createGain(),g=l.createGain(),x=l.createGain();return m.connect(d),m.connect(y),d.connect(p),p.connect(f),p.connect(x),f.connect(d),y.connect(g),x.connect(g),d.delayTime.value=e,y.gain.value=i,f.gain.value=n,p.detune.value=r,p.frequency.value=o,p.gain.value=a,p.Q.value=s,p.type=u,m.gain.value=1,g.gain.value=1,x.gain.value=h,{input:m,output:g,param:{dry:y.gain,delay:d.delayTime,feedback:f.gain,filter:{detune:p.detune,gain:p.gain,frequency:p.frequency,Q:p.Q},gain:g.gain,wet:x.gain}}},t.audio.effect.createFeedbackDelay=({delay:e=.5,dry:i=1,feedback:n=.5,maxDelayTime:r=1,wet:o=.5}={})=>{const a=t.audio.context(),s=a.createDelay(r),u=a.createGain(),c=a.createGain(),h=a.createGain(),l=a.createGain(),d=a.createGain();return h.connect(s),h.connect(u),s.connect(c),s.connect(d),c.connect(s),u.connect(l),d.connect(l),s.delayTime.value=e,u.gain.value=i,c.gain.value=n,h.gain.value=1,l.gain.value=1,d.gain.value=o,{input:h,output:l,param:{dry:u.gain,delay:s.delayTime,feedback:c.gain,gain:l.gain,wet:d.gain}}},t.audio.effect.createMultitapFeedbackDelay=({dry:e=1,tap:i=[],wet:n=.5}={})=>{const r=t.audio.context(),o=r.createGain(),a=r.createGain(),s=r.createGain(),u=r.createGain();a.connect(o),o.connect(s),u.connect(s),o.gain.value=e,a.gain.value=1,s.gain.value=1,u.gain.value=n;const c=i.map(({delay:t=.5,feedback:e=.5,gain:i=1,maxDelayTime:n=1}={})=>{const o=r.createDelay(n),s=r.createGain(),c=r.createGain();return a.connect(c),c.connect(o),o.connect(s),o.connect(u),s.connect(o),o.delayTime.value=t,s.gain.value=e,c.gain.value=i,{delay:o.delayTime,feedback:s.gain,gain:c.gain}});return{input:a,output:s,param:{dry:o.gain,gain:s.gain,tap:c,wet:u.gain}}},t.audio.effect.createPhaser=({dry:e=.5,depth:i=.001,delay:n=.01,feedback:r=t.const.zeroGain,frequency:o=1,type:a="sine",wet:s=.5,when:u=t.audio.time()}={})=>{const c=t.audio.context(),h=c.createDelay(),l=c.createGain(),d=c.createGain(),y=c.createGain(),f=c.createGain(),p=c.createOscillator(),m=c.createGain(),g=c.createGain();return h.delayTime.value=n,l.gain.value=i,d.gain.value=e,y.gain.value=r,p.frequency.value=o,g.gain.value=s,f.connect(d),f.connect(h),h.connect(g),h.connect(y),y.connect(h),d.connect(m),g.connect(m),p.connect(l),p.type=a,p.start(u),l.connect(h.delayTime),{input:f,output:m,param:{delay:h.delayTime,depth:l.gain,dry:d.gain,feedback:y.gain,frequency:p.frequency,gain:m.gain,wet:g.gain},stop:function(e=t.audio.time()){return p.stop(e),this}}},t.audio.effect.createPingPongDelay=function({delay:e=.5,dry:i=1,feedback:n=.5,maxDelayTime:r=1,wet:o=.5}={}){const a=t.audio.context(),s=a.createDelay(r),u=a.createGain(),c=a.createGain(),h=a.createGain(),l=a.createChannelMerger(2),d=a.createGain(),y=a.createStereoPanner(),f=a.createChannelSplitter(2),p=a.createGain();return h.connect(u),h.connect(y),y.connect(f),f.connect(l,0,1),f.connect(l,1,0),l.connect(s),s.connect(c),s.connect(p),c.connect(y),u.connect(d),p.connect(d),s.delayTime.value=e,u.gain.value=i,c.gain.value=n,h.gain.value=1,d.gain.value=1,p.gain.value=o,{input:h,output:d,param:{dry:u.gain,delay:s.delayTime,feedback:c.gain,gain:d.gain,wet:p.gain}}},t.audio.effect.createShaper=({curve:e=t.audio.shape.warm(),dry:i=0,preGain:n=1,wet:r=1}={})=>{const o=t.audio.context(),a=o.createGain(),s=o.createGain(),u=o.createGain(),c=o.createGain(),h=o.createWaveShaper(),l=o.createGain();return a.gain.value=i,c.gain.value=n,h.curve=e,l.gain.value=r,s.connect(a),s.connect(c),c.connect(h),h.connect(l),a.connect(u),l.connect(u),{input:s,output:u,param:{dry:a.gain,gain:u.gain,preGain:inputGain.gain,wet:l.gain}}},t.audio.effect.createTalkbox=({dry:e=0,formant0:i=t.audio.formant.createU(),formant1:n=t.audio.formant.createA(),mix:r=.5,wet:o=1}={})=>{const a=t.audio.context(),s=a.createGain(),u=a.createGain(),c=a.createGain(),h=a.createConstantSource(),l=a.createGain(),d=a.createGain(),y=a.createGain(),f=a.createGain();return s.gain.value=e,h.offset.value=r,f.gain.value=o,h.connect(d.gain),d.gain.value=0,h.connect(c),c.connect(l.gain),c.gain.value=-1,l.gain.value=1,u.connect(s),u.connect(l),u.connect(d),h.start(),l.connect(i.input),d.connect(n.input),i.output.connect(f),n.output.connect(f),s.connect(y),f.connect(y),{input:u,output:y,param:{dry:s.gain,formant0:i.param,formant1:n.param,mix:h.offset,wet:f.gain},stop:function(e=t.audio.time()){return h.stop(e),this}}},t.audio.export=({duration:e=0,input:i=t.audio.mixer.master.output(),name:n="export.webm"}={})=>{if(!(i instanceof AudioNode))throw new Error("Input must be an AudioNode");const r=t.audio.context(),o=[],a=r.createMediaStreamDestination(),s=new MediaRecorder(a.stream);return s.ondataavailable=t=>o.push(t.data),s.onstop=()=>{try{i.disconnect(a)}catch(t){}const t=new Blob(o,{type:s.mimeType}),e=URL.createObjectURL(t),r=document.createElement("a");r.download=n,r.href=e,r.click(),r.remove()},i.connect(a),s.start(),e>0&&setTimeout(()=>s.stop(),1e3*e),s},t.audio.formant={},t.audio.formant.blend=(e,i,n=0)=>{const r=(e,i)=>e[i]&&e[i].frequency||t.const.zero,o=(e,i)=>e[i]&&e[i].gain||t.const.zeroGain,a=(t,e)=>t[e]&&t[e].Q||1;return[...Array(Math.max(e.length,i.length))].map((s,u)=>({frequency:t.utility.lerp(r(e,u),r(i,u),n),gain:t.utility.lerp(o(e,u),o(i,u),n),Q:t.utility.lerp(a(e,u),a(i,u),n)}))},t.audio.formant.create=(e=[])=>{const i=t.audio.context(),n=i.createGain(),r=i.createGain(),o=e.map(({frequency:t=0,gain:e=1,Q:o=1}={})=>{const a=i.createBiquadFilter();a.frequency.value=t,a.Q.value=o,a.type="bandpass";const s=i.createGain();return s.gain.value=e,n.connect(a),a.connect(s),s.connect(r),{filter:{frequency:a.frequency,Q:a.Q},gain:s}});return{input:n,output:r,param:{filter:o}}},t.audio.formant.createA=function(){return this.create(this.a())},t.audio.formant.createE=function(){return this.create(this.e())},t.audio.formant.createI=function(){return this.create(this.i())},t.audio.formant.createO=function(){return this.create(this.o())},t.audio.formant.createU=function(){return this.create(this.u())},t.audio.formant.transition=function(e,i=[],n=t.const.zeroTime){const r=e.param?e.param.filter:e;if(!Array.isArray(r)||!r[0]||!r[0].filter)throw new Error("Invalid plugin");return r.forEach((e,r)=>{if(!i[r])return void t.audio.ramp.linear(e.gain.gain,t.const.zeroGain,n);const{frequency:o,gain:a,Q:s}=i[r];void 0!==o&&t.audio.ramp.exponential(e.filter.frequency,o,n),void 0!==a&&t.audio.ramp.linear(e.gain.gain,a,n),void 0!==s&&t.audio.ramp.exponential(e.filter.Q,s,n)}),t.utility.timing.promise(1e3*n)},t.audio.formant.a=()=>[{frequency:599,gain:1,Q:5},{frequency:1001,gain:1,Q:20},{frequency:2045,gain:1,Q:50},{frequency:2933,gain:1,Q:80}],t.audio.formant.e=()=>[{frequency:469,gain:1,Q:5},{frequency:2150,gain:1,Q:20},{frequency:2836,gain:1,Q:50},{frequency:3311,gain:1,Q:80}],t.audio.formant.i=()=>[{frequency:274,gain:1,Q:5},{frequency:1704,gain:1,Q:20},{frequency:2719,gain:1,Q:50},{frequency:3404,gain:1,Q:80}],t.audio.formant.o=()=>[{frequency:411,gain:1,Q:5},{frequency:784,gain:1,Q:20},{frequency:2176,gain:1,Q:50},{frequency:2987,gain:1,Q:80}],t.audio.formant.u=()=>[{frequency:290,gain:1,Q:5},{frequency:685,gain:1,Q:20},{frequency:2190,gain:1,Q:50},{frequency:3154,gain:1,Q:80}],t.audio.mixer=(()=>{const e=t.audio.context(),i=e.createGain(),n=e.createDynamicsCompressor(),r=e.createGain(),o=e.createGain();let a,s;function u(i=t.const.minFrequency,o=t.const.maxFrequency){a=e.createBiquadFilter(),a.type="highpass",a.frequency.value=i,s=e.createBiquadFilter(),s.type="lowpass",s.frequency.value=o,r.connect(a),a.connect(s),s.connect(n)}return n.connect(i),i.connect(o),o.connect(e.destination),i.gain.value=1,n.attack.value=t.const.zeroTime,n.knee.value=0,n.ratio.value=20,n.release.value=t.const.zeroTime,n.threshold.value=0,u(),{auxiliary:{},createBus:()=>{const t=e.createGain();return t.connect(r),t},master:{input:()=>r,output:()=>o,param:{gain:o.gain,highpass:{frequency:a.frequency},limiter:{attack:n.attack,gain:i.gain,knee:n.knee,ratio:n.ratio,release:n.release,threshold:n.threshold},lowpass:{frequency:s.frequency}}},rebuildFilters:function(){const t=a.frequency.value,e=s.frequency.value;return this.auxiliary.reverb.rebuildFilters(),r.disconnect(),s.disconnect(),s=null,a.disconnect(),a=null,u(t,e),this.master.param.highpass.frequency=a.frequency,this.master.param.lowpass.frequency=s.frequency,this},send:{}}})(),t.audio.ramp={},t.audio.ramp.curve=function(e,i,n=t.const.zeroTime){return e.cancelScheduledValues(0),e.setValueCurveAtTime(i,t.audio.time(),t.audio.time(n)),this},t.audio.ramp.exponential=function(e,i,n=t.const.zeroTime){return t.audio.ramp.hold(e),e.exponentialRampToValueAtTime(i,t.audio.time(n)),this},t.audio.ramp.hold=function(e){return e.cancelScheduledValues(0),e.setValueAtTime(e.value,t.audio.time()),this},t.audio.ramp.linear=function(e,i,n=t.const.zeroTime){return t.audio.ramp.hold(e),e.linearRampToValueAtTime(i,t.audio.time(n)),this},t.audio.ramp.set=function(e,i){return t.audio.ramp.linear(e,i,t.performance.delta()),this},t.audio.shape=(()=>{const e=D(4),i=D(6),n=D(8),r=D(12),o=A(8*Math.PI),a=F(t.const.zeroGain),s=I(2),u=O(2),c=new Float32Array(65536),h=A(4*Math.PI),l=new Float32Array([1,0,-1]),d=new Float32Array([-1,0,1]),y=F(1),f=F(t.utility.fromDb(-3)),p=F(t.utility.fromDb(-6)),m=F(t.utility.fromDb(-9)),g=F(t.utility.fromDb(-12)),x=F(t.utility.fromDb(-15)),v=new Float32Array([1,1]),w=new Float32Array([0,0,1]),b=new Float32Array([1,0,1]),q=new Float32Array(128),z=I(3),M=O(3),G=A(Math.PI),P=new Float32Array([0,0]);for(let t=0;t<c.length;t+=1){const e=t/(c.length-1)*2-1;c[t]=Math.sqrt(.5*(1+e))}const S=c.slice().reverse();for(let t=0;t<q.length;t+=1)q[t]=t<q.length/2?-1:1;function D(t=16,e=65536){const i=2**(t-1),n=new Float32Array(e);for(let t=0;t<n.length;t+=1){const r=2*t/(e-1)-1;n[t]=Math.round(r*i)/i}return n[e-1]=1,n}function F(e=1,i=65536){const n=new Float32Array(i),r=t.utility.srand("syngen.audio.shape.createNoise",e),o=i=>t.utility.wrapAlternate(i+r(-e,e),0,2)-1;for(let t=0;t<n.length;t+=1){const e=2*t/(i-1);n[t]=o(e)}return n[i-1]=o(2),n}function A(t=0,e=65536){const i=new Float32Array(e);for(let n=0;n<e;n+=1){const r=2*n/e-1;i[n]=r*(Math.PI+t)/(Math.PI+t*Math.abs(r))}return i}function I(t=1){const e=4*t-1,i=new Float32Array(e);for(let t=0;t<e;t+=1)i[t]=t%2?0:t<e/2?-(2**(-t/2)):2**-Math.floor((e-t)/2);return i}function O(t=1){const e=2*t,i=new Float32Array(e);for(let t=0;t<e;t+=1)i[t]=t%2?0:2**(-t/2);return i}return{constant:(t=0)=>new Float32Array([t,t]),createBitcrush:D,createNoise:F,createRandom:function(e=2,i=""){const n=new Float32Array(samples),r=t.utility.srand("syngen.audio.shape.createRandom",i);for(let t=0;t<e;t+=1)n[t]=r(-1,1);return n},createSigmoid:A,createTuple:I,createTuplePulse:O,crush12:()=>r,crush4:()=>e,crush6:()=>i,crush8:()=>n,distort:()=>o,dither:()=>a,double:()=>s,doublePulse:()=>u,equalFadeIn:()=>c,equalFadeOut:()=>S,hot:()=>h,invert:()=>l,invertShape:t=>t.map(t=>-t),linear:()=>d,noise:()=>y,noise2:()=>f,noise4:()=>p,noise8:()=>m,noise16:()=>g,noise32:()=>x,offsetShape:(t,e=0)=>t.map(t=>t+e),one:()=>v,pulse:()=>w,pulseShape:t=>t.map(t=>t>0?t:0),rectify:()=>b,rectifyShape:t=>t.map(Math.abs),reverseShape:t=>t.slice().reverse(),square:()=>q,triple:()=>z,triplePulse:()=>M,warm:()=>G,zero:()=>P}})(),t.audio.synth={},t.audio.synth.assign=function(t,e,i){return t.param||(t.param={}),e in t?(Array.isArray(t[e])||(t[e]=[t[e]],t.param[e]=[t.param[e]]),t[e].push(i),t.param[e].push(i.param||{})):(t[e]=i,t.param[e]=i.param||{}),t},t.audio.synth.chain=function(t,e){const i=e.input||e,n=e.output||e,r=t._chain,o=t.output;if(!r||!r.connect)throw new Error("Synth has no chain");if(!o||!o.connect)throw new Error("Synth has no output");if(!i||!i.connect)throw new Error("Plugin has no input");if(!n||!n.connect)throw new Error("Plugin has no output");return r.disconnect(o),r.connect(i),n.connect(o),t._chain=n,this.chainStop(t,e),t},t.audio.synth.chainAssign=function(t,e,i){return this.assign(t,e,i),this.chain(t,i),t},t.audio.synth.chainStop=function(t,e){const i=e.stop,n=t.stop;if(!i)return t;if(!n)throw new Error("Synth has no stop");return t.stop=function(...t){return i(...t),n(...t),this},t},t.audio.synth.createAdditive=({detune:e=0,frequency:i,gain:n=t.const.zeroGain,harmonic:r=[],when:o=t.audio.time()}={})=>{const a=t.audio.context(),s=a.createConstantSource(),u=a.createConstantSource(),c=a.createGain(),h=a.createGain();s.start(o),u.start(o);const l=Math.max(r.length-1,1),d=r.map(({coefficient:t=1,detune:e=0,gain:i=1,type:n="sine"})=>{const r=a.createGain(),c=a.createGain(),d=a.createOscillator();return r.gain.value=t,d.detune.value=e,d.frequency.value=0,d.type=n,c.gain.value=i/l,s.connect(d.detune),u.connect(r),r.connect(d.frequency),d.connect(c),c.connect(h),d.start(o),{oscillator:d,param:{coefficient:r.gain,detune:d.detune,gain:c.gain}}});return h.connect(c),t.audio.synth.setAudioParams([s.offset,e],[u.offset,i],[c.gain,n]),t.audio.synth.decorate({_chain:h,output:c,param:{detune:s.offset,frequency:u.offset,gain:c.gain,harmonic:d.map(t=>t.param)},stop:function(e=t.audio.time()){return s.onended=()=>{c.disconnect()},s.stop(e),u.stop(e),d.forEach(t=>t.oscillator.stop(e)),this}})},t.audio.synth.createAm=({carrierDetune:e=0,carrierFrequency:i,carrierGain:n=1,carrierType:r="sine",gain:o=t.const.zeroGain,modDepth:a=t.const.zeroGain,modDetune:s=0,modFrequency:u,modType:c="sine",modWhen:h,when:l=t.audio.time()}={})=>{const d=t.audio.context(),y=d.createGain(),f=d.createOscillator(),p=d.createGain(),m=d.createOscillator(),g=d.createGain();return y.connect(g),f.connect(y),f.type=r,f.start(l),p.connect(y.gain),m.connect(p),m.type=c,m.start(h||l),t.audio.synth.setAudioParams([y.gain,n],[f.detune,e],[f.frequency,i],[p.gain,a],[m.detune,s],[m.frequency,u],[g.gain,o]),t.audio.synth.decorate({_chain:y,output:g,param:{carrierGain:y.gain,detune:f.detune,frequency:f.frequency,gain:g.gain,mod:{depth:p.gain,detune:m.detune,frequency:m.frequency}},stop:function(e=t.audio.time()){return f.onended=()=>{g.disconnect()},f.stop(e),m.stop(e),this}})},t.audio.synth.createAmBuffer=({buffer:e,carrierGain:i=1,detune:n=0,gain:r=t.const.zeroGain,loop:o=!0,loopEnd:a,loopStart:s,modDepth:u=t.const.zeroGain,modDetune:c=0,modFrequency:h,modType:l="sine",modWhen:d,playbackRate:y=1,when:f=t.audio.time()}={})=>{const p=t.audio.context(),m=p.createGain(),g=p.createGain(),x=p.createOscillator(),v=p.createGain(),w=p.createBufferSource();return m.connect(v),w.buffer=e,w.loop=o,w.connect(m),w.start(f,t.utility.random.float(0,e.length)),o&&void 0!==a&&(w.loopEnd=a),o&&void 0!==s&&(w.loopStart=s),g.connect(m.gain),x.connect(g),x.type=l,x.start(d||f),t.audio.synth.setAudioParams([m.gain,i],[w.detune,n],[w.playbackRate,y],[g.gain,u],[x.detune,c],[x.frequency,h],[v.gain,r]),t.audio.synth.decorate({_chain:m,output:v,param:{carrierGain:m.gain,detune:w.detune,gain:v.gain,mod:{depth:g.gain,detune:x.detune,frequency:x.frequency},playbackRate:w.playbackRate},stop:function(e=t.audio.time()){return w.onended=()=>{v.disconnect()},w.stop(e),x.stop(e),this}})},t.audio.synth.createBuffer=({buffer:e,detune:i=0,gain:n=t.const.zeroGain,loop:r=!0,loopEnd:o,loopStart:a,playbackRate:s=1,when:u=t.audio.time()}={})=>{const c=t.audio.context(),h=c.createGain(),l=c.createBufferSource();return l.buffer=e,l.loop=r,l.connect(h),l.start(u,t.utility.random.float(0,e.length)),r&&void 0!==o&&(l.loopEnd=o),r&&void 0!==a&&(l.loopStart=a),t.audio.synth.setAudioParams([l.detune,i],[l.playbackRate,s],[h.gain,n]),t.audio.synth.decorate({_chain:l,output:h,param:{detune:l.detune,gain:h.gain,playbackRate:l.playbackRate},source:l,stop:function(e=t.audio.time()){return l.onended=()=>{h.disconnect()},l.stop(e),this}})},t.audio.synth.createFm=({carrierDetune:e=0,carrierFrequency:i,carrierType:n="sine",gain:r=t.const.zeroGain,modDepth:o=t.const.zeroGain,modDetune:a=0,modFrequency:s,modType:u="sine",modWhen:c,when:h=t.audio.time()}={})=>{const l=t.audio.context(),d=l.createOscillator(),y=l.createGain(),f=l.createOscillator(),p=l.createGain();return d.connect(p),d.type=n,d.start(h),y.connect(d.frequency),f.connect(y),f.type=u,f.start(c||h),t.audio.synth.setAudioParams([d.detune,e],[d.frequency,i],[y.gain,o],[f.detune,a],[f.frequency,s],[p.gain,r]),t.audio.synth.decorate({_chain:d,output:p,param:{detune:d.detune,frequency:d.frequency,gain:p.gain,mod:{depth:y.gain,detune:f.detune,frequency:f.frequency}},stop:function(e=t.audio.time()){return d.onended=()=>{p.disconnect()},d.stop(e),f.stop(e),this}})},t.audio.synth.createLfo=({depth:e=t.const.zeroGain,detune:i=0,frequency:n=0,type:r="sine",when:o=t.audio.time()}={})=>{const a=t.audio.context(),s=a.createGain(),u=a.createOscillator();return u.type=r,u.connect(s),u.start(o),t.audio.synth.setAudioParams([s.gain,e],[u.detune,i],[u.frequency,n]),t.audio.synth.decorate({_chain:u,param:{depth:s.gain,detune:u.detune,frequency:u.frequency},output:s,stop:function(e=t.audio.time()){return u.onended=()=>{s.disconnect()},u.stop(e),this}})},t.audio.synth.createMod=({amodDepth:e=t.const.zeroGain,amodDetune:i=0,amodFrequency:n,amodType:r="sine",amodWhen:o,carrierDetune:a=0,carrierFrequency:s,carrierGain:u=1,carrierType:c="sine",gain:h=t.const.zeroGain,fmodDepth:l=t.const.zeroGain,fmodDetune:d=0,fmodFrequency:y,fmodType:f="sine",fmodWhen:p,when:m=t.audio.time()}={})=>{const g=t.audio.context(),x=g.createGain(),v=g.createOscillator(),w=g.createGain(),b=g.createOscillator(),q=g.createGain(),z=g.createOscillator(),M=g.createGain();return w.connect(M),b.connect(w),b.type=c,b.start(m),x.connect(w.gain),v.connect(x),v.type=r,v.start(o||m),q.connect(b.frequency),z.connect(q),z.type=f,z.start(p||m),t.audio.synth.setAudioParams([x.gain,e],[v.detune,i],[v.frequency,n],[w.gain,u],[b.detune,a],[b.frequency,s],[q.gain,l],[z.detune,d],[z.frequency,y],[M.gain,h]),t.audio.synth.decorate({_chain:w,output:M,param:{amod:{depth:x.gain,detune:v.detune,frequency:v.frequency},carrierGain:w.gain,fmod:{depth:q.gain,detune:z.detune,frequency:z.frequency},detune:b.detune,frequency:b.frequency,gain:M.gain},stop:function(e=t.audio.time()){return b.onended=()=>{M.disconnect()},v.stop(e),b.stop(e),z.stop(e),this}})},t.audio.synth.createPwm=({detune:e=0,frequency:i,gain:n=t.const.zeroGain,type:r="sine",when:o=t.audio.time(),width:a=0}={})=>{const s=t.audio.context(),u=s.createGain(),c=s.createOscillator(),h=s.createGain(),l=s.createWaveShaper(),d=s.createWaveShaper(),y=s.createGain();return c.type=r,l.curve=t.audio.shape.one(),d.curve=t.audio.shape.square(),u.connect(h),c.connect(l),c.connect(d),l.connect(y),d.connect(u),y.connect(d),c.start(o),t.audio.synth.setAudioParams([c.detune,e],[c.frequency,i],[h.gain,n],[y.gain,a]),t.audio.synth.decorate({_chain:u,output:h,param:{detune:c.detune,frequency:c.frequency,gain:h.gain,width:y.gain},stop:function(e=t.audio.time()){return c.onended=()=>{h.disconnect()},c.stop(e),this},width:y})},t.audio.synth.createSimple=({detune:e=0,frequency:i,gain:n=t.const.zeroGain,type:r="sine",when:o=t.audio.time()}={})=>{const a=t.audio.context(),s=a.createOscillator(),u=a.createGain();return s.connect(u),s.type=r,s.start(o),t.audio.synth.setAudioParams([s.detune,e],[s.frequency,i],[u.gain,n]),t.audio.synth.decorate({_chain:s,output:u,param:{detune:s.detune,frequency:s.frequency,gain:u.gain},stop:function(e=t.audio.time()){return s.onended=()=>{u.disconnect()},s.stop(e),this}})},t.audio.synth.decorate=(e={})=>Object.setPrototypeOf(e,t.audio.synth.decoration),t.audio.synth.decoration={assign:function(...e){return t.audio.synth.assign(this,...e)},chain:function(...e){return t.audio.synth.chain(this,...e)},chainAssign:function(...e){return t.audio.synth.chainAssign(this,...e)},chainStop:function(...e){return t.audio.synth.chainStop(this,...e)},connect:function(...t){return this.output.connect(...t),this},disconnect:function(...t){return this.output.disconnect(...t),this},filtered:function(...e){return t.audio.synth.filtered(this,...e)},shaped:function(...e){return t.audio.synth.shaped(this,...e)}},t.audio.synth.filtered=function(e,{detune:i,gain:n,frequency:r,Q:o,type:a="lowpass"}={}){const s=t.audio.context().createBiquadFilter();return s.type=a,t.audio.synth.setAudioParams([s.detune,i],[s.gain,n],[s.frequency,r],[s.Q,o]),this.chainAssign(e,"filter",s)},t.audio.synth.setAudioParams=function(...t){for(const[e,i]of t)e instanceof AudioParam&&void 0!==i&&(e.value=i);return this},t.audio.synth.shaped=function(e,i){const n=t.audio.context().createWaveShaper();return n.curve=i,this.chainAssign(e,"shaper",n)},t.loop=(()=>{const e=t.utility.pubsub.create();let i,n,r=0,o=0,a=!1,s=!1,u=0,c=0;function h(){cancelAnimationFrame(i),clearTimeout(n)}function l(){const t=performance.now();r=(t-u)/1e3,u=t,y()}function d(){r=t.const.idleDelta,u=performance.now(),y()}function y(){o+=1,c+=r,e.emit("frame",{delta:r,frame:o,paused:a,time:c}),f()}function f(){document.hidden?n=setTimeout(d,function(){const e=u?performance.now()-u:0;return Math.max(0,1e3*t.const.idleDelta-e)}()):i=requestAnimationFrame(l)}return document.addEventListener("visibilitychange",()=>{s&&(h(),f())}),t.utility.pubsub.decorate({delta:()=>r,frame:()=>o,isPaused:()=>a,isRunning:()=>s,pause:function(){return a||(a=!0,e.emit("pause")),this},resume:function(){return a?(a=!1,e.emit("resume"),this):this},start:function(){return s||(s=!0,u=performance.now(),f(),e.emit("start")),this},stop:function(){return s?(h(),r=0,o=0,s=!1,u=0,c=0,e.emit("stop"),this):this},time:()=>c},e)})(),t.input.gamepad=(()=>{let e=.1875,i={analog:{},axis:{},digital:{}};function n(i){const n=(Math.abs(i)-e)/(1-e);return n>0?t.utility.sign(i)*n:0}return{get:()=>({analog:{...i.analog},axis:{...i.axis},digital:{...i.digital}}),getAnalog:function(t,e=!1){const n=i.analog[t]||0;return e&&n?1-n:n},getAxis:function(t,e=!1){const n=i.axis[t]||0;return e&&n?-1*n:n},hasAxis:function(...t){for(const e of t)if(!(e in i.axis))return!1;return!0},isDigital:t=>Boolean(i.digital[t]),reset:function(){return i={analog:{},axis:{},digital:{}},this},setDeadzone:function(t=0){return e=Number(t)||0,this},update:function(){const e=navigator.getGamepads();this.reset();for(const r of e)r&&(r.axes.forEach((e,r)=>{e=n(e),r in i.axis||(i.axis[r]=0),i.axis[r]=t.utility.clamp(i.axis[r]+e,-1,1)||0}),r.buttons.forEach((t,e)=>{e in i.analog||(i.analog[e]=0),i.analog[e]=Math.min(i.analog[e]+t.value,1)||0,i.digital[e]|=t.pressed}));return this}}})(),t.loop.on("frame",()=>t.input.gamepad.update()),t.input.keyboard=(()=>{let t={};return window.addEventListener("keydown",function(e){if(e.repeat)return;t[e.code]=!0}),window.addEventListener("keyup",function(e){t[e.code]=!1}),{get:()=>({...t}),is:e=>t[e]||!1,reset:function(){return t={},this}}})(),window.addEventListener("blur",e=>{e.target===window&&t.input.keyboard.reset()}),t.input.mouse=(()=>{let t={moveX:0,moveY:0,wheelX:0,wheelY:0,wheelZ:0},e={button:{},moveX:0,moveY:0,wheelX:0,wheelY:0,wheelZ:0};return window.addEventListener("mousedown",function(t){e.button[t.button]=!0}),window.addEventListener("mousemove",function(t){e.moveX+=t.movementX,e.moveY+=t.movementY}),window.addEventListener("mouseup",function(t){e.button[t.button]=!1}),window.addEventListener("wheel",function(t){e.wheelX+=t.deltaX,e.wheelY+=t.deltaY,e.wheelZ+=t.deltaZ}),{get:()=>({...e,button:{...e.button}}),getMoveX:()=>e.moveX||0,getMoveY:()=>e.moveY||0,getWheelX:()=>e.wheelX||0,getWheelY:()=>e.wheelY||0,getWheelZ:()=>e.wheelZ||0,isButton:t=>e.button[t]||!1,reset:function(){return t={moveX:0,moveY:0,wheelX:0,wheelY:0,wheelZ:0},e={button:{},moveX:0,moveY:0,wheelX:0,wheelY:0,wheelZ:0},this},update:function(){return e.moveX-=t.moveX,e.moveY-=t.moveY,e.wheelX-=t.wheelX,e.wheelY-=t.wheelY,e.wheelZ-=t.wheelZ,t={moveX:e.moveX,moveY:e.moveY,wheelX:e.wheelX,wheelY:e.wheelY,wheelZ:e.wheelZ},this}}})(),t.loop.on("frame",()=>t.input.mouse.update()),t.performance=(()=>{const e=[];let i=0,n=0,r=0;return{delta:()=>n,fps:()=>r,update:function({delta:o}){e[i]=o,i<29?i+=1:i=0;const a=e.slice().sort();return n=t.utility.choose(a,.5),r=1/n,this}}})(),t.loop.on("frame",e=>t.performance.update(e)),t.position=(()=>{const e=t.utility.physical.decorate({});return{export:()=>({quaternion:{w:e.quaternion.w,x:e.quaternion.x,y:e.quaternion.y,z:e.quaternion.z},x:e.x,y:e.y,z:e.z}),getAngularVelocity:()=>e.angularVelocity.clone(),getAngularVelocityEuler:()=>t.utility.euler.fromQuaternion(e.angularVelocity),getEuler:()=>e.euler(),getQuaternion:()=>e.quaternion.clone(),getVector:()=>e.vector(),getVelocity:()=>e.velocity.clone(),import:function({quaternion:i=t.utility.quaternion.identity(),x:n=0,y:r=0,z:o=0}={}){return e.x=n,e.y=r,e.z=o,e.quaternion.set(i),e.resetPhysics(),this},rect:()=>({depth:2*t.const.positionRadius,height:2*t.const.positionRadius,width:2*t.const.positionRadius,x:e.x-t.const.positionRadius,y:e.y-t.const.positionRadius,z:e.z-t.const.positionRadius}),reset:function(){return this.import()},setAngularVelocity:function({w:i=0,x:n=0,y:r=0,z:o=0}=t.utility.quaternion.identity()){return e.angularVelocity.set({w:i,x:n,y:r,z:o}),this},setAngularVelocityEuler:function({pitch:i=0,roll:n=0,yaw:r=0}={}){return e.angularVelocity.set(t.utility.quaternion.fromEuler({pitch:i,roll:n,yaw:r})),this},setEuler:function({pitch:i=0,roll:n=0,yaw:r=0}={}){return e.quaternion.set(t.utility.quaternion.fromEuler({pitch:i,roll:n,yaw:r})),this},setQuaternion:function({w:i=0,x:n=0,y:r=0,z:o=0}=t.utility.quaternion.identity()){return e.quaternion.set({w:i,x:n,y:r,z:o}),this},setVector:function({x:t=0,y:i=0,z:n=0}={}){return e.x=t,e.y=i,e.z=n,this},setVelocity:function({x:t=0,y:i=0,z:n=0}={}){return e.velocity.set({x:t,y:i,z:n}),this},update:function(){return e.updatePhysics(),this}}})(),t.loop.on("frame",({paused:e})=>{e||t.position.update()}),t.state.on("export",(e={})=>e.position=t.position.export()),t.state.on("import",(e={})=>t.position.import(e.position)),t.state.on("reset",()=>t.position.reset()),t.prop.base={binaural:void 0,construct:function({destination:e=t.audio.mixer.master.input(),radius:i=this.radius||0,token:n=t.utility.uuid(),x:r=0,y:o=0,z:a=0,...s}={}){const u=t.audio.context();return this.binaural=t.audio.binaural.create(),this.instantiated=!0,this.output=u.createGain(),this.radius=i,this.token=n,this.x=r,this.y=o,this.z=a,this.output.gain.value=t.const.zeroGain,this.binaural.from(this.output),this.binaural.to(e),this.reverb&&(this.reverb=t.audio.mixer.send.reverb.create(),this.reverb.from(this.output)),t.utility.physical.decorate(this),this.recalculate(),this.onConstruct(s),t.audio.ramp.linear(this.output.gain,1,this.fadeInDuration),this},destroy:function(){return t.audio.ramp.linear(this.output.gain,t.const.zeroGain,this.fadeOutDuration),setTimeout(()=>{this.output.disconnect(),this.binaural.destroy(),this.reverb&&this.reverb.destroy(),this.onDestroy()},1e3*(t.const.audioLookaheadTime+this.fadeOutDuration)),this},distance:void 0,fadeInDuration:t.const.zeroTime,fadeOutDuration:t.const.zeroTime,instantiated:!1,invent:function(t={}){return"function"==typeof t&&(t=t(this)),Object.setPrototypeOf({...t},this)},name:"base",onConstruct:()=>{},onDestroy:()=>{},onUpdate:()=>{},output:void 0,radius:0,recalculate:function(){const e=t.position.getQuaternion(),i=t.position.getVector();return this.relative=this.vector().subtract(i).subtractRadius(this.radius).rotateQuaternion(e.conjugate()),this.distance=this.relative.distance(),this.binaural.update({...this.relative}),this.reverb&&this.reverb.update({...this.relative}),this},rect:function(){return{depth:2*this.radius,height:2*this.radius,width:2*this.radius,x:this.x-this.radius,y:this.y-this.radius,z:this.y-this.radius}},relative:void 0,reverb:!0,token:void 0,update:function({paused:t}={}){return this.onUpdate.apply(this,arguments),t||(this.updatePhysics(),this.recalculate()),this}},t.prop.null=t.prop.base.invent({name:"null"}),t.props=(()=>{const e=new Set;return{create:function(i,n={}){(function(e){return t.prop.base.isPrototypeOf(e)})(i)||(i=t.prop.null);const r=Object.create(i).construct(n);return e.add(r),r},destroy:function(...t){for(const i of t)i.destroy&&i.destroy(),e.delete(i);return this},get:()=>[...e],reset:function(){return e.forEach(t=>t.destroy()),e.clear(),this},update:function({...t}={}){return e.forEach(e=>e.update({...t})),this}}})(),t.loop.on("frame",e=>t.props.update(e)),t.state.on("reset",()=>t.props.reset()),t.streamer=(()=>{const e=new Map,i=t.utility.octree.create(),n=new Map;let r=t.utility.vector3d.create(),o=1/0,a=t.const.speedOfSound,s=!1,u=(t,e)=>t.distance-e.distance;function c(i){if(!e.has(i))return;const{options:r,prototype:o}=e.get(i),a=t.props.create(o,r);n.set(i,a)}function h(e){if(!n.has(e))return;const i=n.get(e);t.props.destroy(i),n.delete(e)}return{deregisterProp:function(t){const n=e.get(t);return n?(e.delete(t),i.remove(n),this):this},destroyStreamedProp:function(t){return h(t),this},getLimit:()=>o,getRadius:()=>a,getRegisteredProp:t=>e.get(t),getRegisteredProps:()=>[...e.values()],getStreamedProp:t=>n.get(t),getStreamedProps:()=>[...n.values()],hasRegisteredProp:t=>e.has(t),hasStreamedProp:t=>n.has(t),registerProp:function(n,r={}){const o=function(){let i;do{i=t.utility.uuid()}while(e.has(i));return i}(),a={options:{...r,token:o},prototype:n,token:o,x:r.x,y:r.y,z:r.z};return e.set(o,a),i.insert(a),s=!0,o},reset:function(){return e.clear(),i.clear(),n.forEach(t=>t.destroy()),n.clear(),s=!1,this},setLimit:function(t){return t>0&&(o=Number(t)||1/0,s=!0),this},setRadius:function(t){return a=Number(t)||0,s=!0,this},setSort:function(t){return"function"==typeof u&&(u=t,s=!0),this},update:function(e=!1){const l=t.position.getVector();if(!e&&!s&&r.equals(l))return this;r=l,s=!1;const d=new Set,y=function(){const t=[...i.retrieve({depth:2*a,height:2*a,width:2*a,x:r.x-a,y:r.y-a,z:r.z-a}).filter(({token:t})=>!n.has(t)).map(t=>Object.setPrototypeOf({...t.options,distance:r.distance(t)},t.prototype)),...n.values()].filter(t=>t.distance<=a);return isFinite(o)?t.sort(u).slice(0,o):t}();for(const{token:t}of y)n.has(t)||c(t),d.add(t);for(const t of n.keys())d.has(t)||h(t);return this},updateRegisteredProp:function(t,e={}){const i=propRegistry.get(t);return i?(i.options={...i.options,...e,token:t},this):this}}})(),t.loop.on("frame",({paused:e})=>{e||t.streamer.update()}),t.state.on("reset",()=>t.streamer.reset()),t.audio.binaural.monaural={},t.audio.binaural.monaural.create=function(t){return Object.create(this.prototype).construct(t)},t.audio.binaural.monaural.prototype={construct:function({pan:e=0}){const i=t.audio.context();return this.panSign=t.utility.sign(e),this.angleOffset=-this.panSign*Math.PI/2,this.delay=i.createDelay(),this.filter=i.createBiquadFilter(),this.gain=i.createGain(),this.filter.frequency.value=t.const.maxFrequency,this.gain.gain.value=t.const.zeroGain,this.delay.connect(this.filter),this.filter.connect(this.gain),this},destroy:function(){return this},from:function(t,...e){return t.connect(this.delay,...e),this},to:function(t,...e){return this.gain.connect(t,...e),this},update:function({x:e=0,y:i=0,z:n=0}={}){const r=t.utility.vector3d.create({x:e,y:i+this.panSign*t.const.binauralHeadWidth/2,z:n}).rotateEuler({yaw:this.angleOffse}),o=r.distance(),a=t.utility.distanceToPower(o),s=r.rotateEuler({yaw:this.panSign*t.const.binauralShadowOffset}).euler(),u=Math.cos(s.yaw),c=u>0?t.utility.lerp(.75,1,u):t.utility.lerp(0,.75,1+u),h=t.utility.clamp(t.utility.scale(o,0,t.const.binauralShadowRolloff,0,1),0,1),l=t.utility.lerp(1,c,h),d=Math.min(1,o/t.const.speedOfSound),y=t.utility.lerpExp(t.const.acousticShadowFrequency,t.const.maxFrequency,l),f=t.utility.clamp(a,t.const.zeroGain,1);return t.audio.ramp.set(this.delay.delayTime,d),t.audio.ramp.set(this.filter.frequency,y),t.audio.ramp.set(this.gain.gain,f),this}},t.audio.buffer.impulse.large=(()=>{const e=t.audio.context(),i=e.sampleRate,n=4*i,r=e.createBuffer(1,n,i);for(let t=0;t<r.numberOfChannels;t+=1){const e=r.getChannelData(t);for(let t=0;t<n;t+=1){const i=((n-t)/n)**8;e[t]=i*(2*Math.random()-1)}}return()=>r})(),t.audio.buffer.impulse.medium=(()=>{const e=t.audio.context(),i=e.sampleRate,n=2*i,r=e.createBuffer(1,n,i);for(let t=0;t<r.numberOfChannels;t+=1){const e=r.getChannelData(t);for(let t=0;t<n;t+=1){const i=((n-t)/n)**6;e[t]=i*(2*Math.random()-1)}}return()=>r})(),t.audio.buffer.impulse.small=(()=>{const e=t.audio.context(),i=e.sampleRate,n=1*i,r=e.createBuffer(1,n,i);for(let t=0;t<r.numberOfChannels;t+=1){const e=r.getChannelData(t);for(let t=0;t<n;t+=1){const i=((n-t)/n)**4;e[t]=i*(2*Math.random()-1)}}return()=>r})(),t.audio.buffer.noise.brown=(()=>{const e=t.audio.context(),i=e.sampleRate,n=5*i,r=e.createBuffer(1,n,i),o=r.getChannelData(0);let a=0;for(let t=0;t<n;t+=1){const e=(a+.02*(2*Math.random()-1))/1.02;o[t]=3.5*e,a=e}return()=>r})(),t.audio.buffer.noise.pink=(()=>{const e=t.audio.context(),i=e.sampleRate,n=5*i,r=e.createBuffer(1,n,i),o=r.getChannelData(0);let a=0,s=0,u=0,c=0,h=0,l=0,d=0;for(let t=0;t<n;t+=1){const e=2*Math.random()-1;a=.99886*a+.0555179*e,s=.99332*s+.0750759*e,u=.969*u+.153852*e,c=.8665*c+.3104856*e,h=.55*h+.5329522*e,l=-.7616*l-.016898*e,o[t]=.11*(a+s+u+c+h+l+d+.5362*e),d=.115926*e}return()=>r})(),t.audio.buffer.noise.white=(()=>{const e=t.audio.context(),i=e.sampleRate,n=5*i,r=e.createBuffer(1,n,i),o=r.getChannelData(0);for(let t=0;t<n;t+=1)o[t]=2*Math.random()-1;return()=>r})(),t.audio.mixer.auxiliary.reverb=(()=>{const e=t.audio.context(),i=e.createDelay(),n=e.createGain(),r=t.audio.mixer.createBus(),o=t.utility.pubsub.create();let a,s,u=!0,c=e.createConvolver();function h(n=t.const.minFrequency,r=t.const.maxFrequency){a=e.createBiquadFilter(),a.type="highpass",a.frequency.value=n,s=e.createBiquadFilter(),s.type="lowpass",s.frequency.value=r,i.connect(a),a.connect(s),s.connect(c)}return c.buffer=t.audio.buffer.impulse.small(),i.delayTime.value=1/64,n.connect(i),h(),c.connect(r),t.utility.pubsub.decorate({createSend:()=>{const t=e.createGain();return t.connect(n),t},isActive:()=>u,output:()=>r,param:{delay:i.delayTime,gain:r.gain,highpass:{frequency:a.frequency},lowpass:{frequency:s.frequency}},rebuildFilters:function(){const t=a.frequency.value,e=s.frequency.value;return i.disconnect(),s.disconnect(),s=null,a.disconnect(),a=null,h(t,e),this.param.highpass.frequency=a.frequency,this.param.lowpass.frequency=s.frequency,this},setActive:function(t){return u==t||(u=Boolean(t),u?(o.emit("activate"),n.connect(i)):(o.emit("deactivate"),n.disconnect(i))),this},setImpulse:function(t){return n.disconnect(),c=e.createConvolver(),c.buffer=t,c.connect(r),u&&n.connect(i),this}},o)})(),t.audio.mixer.send.reverb={},t.audio.mixer.send.reverb.create=function(t){return Object.create(this.prototype).construct(t)},t.audio.mixer.send.reverb.prototype={construct:function(e){const i=t.audio.context();return this.delay=i.createDelay(),this.input=i.createGain(),this.relative=t.utility.vector3d.create(),this.send=t.audio.mixer.auxiliary.reverb.createSend(),this.send.gain.value=t.const.zeroGain,this.onSendActivate=this.onSendActivate.bind(this),t.audio.mixer.auxiliary.reverb.on("activate",this.onSendActivate),this.onSendDeactivate=this.onSendDeactivate.bind(this),t.audio.mixer.auxiliary.reverb.on("deactivate",this.onSendDeactivate),t.audio.mixer.auxiliary.reverb.isActive()?this.onSendActivate():this.onSendDeactivate(),this.update(e),this},destroy:function(){return t.audio.mixer.auxiliary.reverb.off("activate",this.onSendActivate),t.audio.mixer.auxiliary.reverb.off("deactivate",this.onSendDeactivate),this.send.disconnect(),this},from:function(t){return t.connect(this.input),this},onSendActivate:function(){return this.update(this.relative),this.input.connect(this.delay),this.delay.connect(this.send),this},onSendDeactivate:function(){return this.input.disconnect(),this.delay.disconnect(),this},update:function({x:e=0,y:i=0,z:n=0}={}){if(this.relative.set({x:e,y:i,z:n}),!t.audio.mixer.auxiliary.reverb.isActive())return this;const r=this.relative.distance(),o=Math.min(t.utility.distanceToPower(r),t.utility.fromDb(-1)),a=t.utility.clamp(r/t.const.speedOfSound,t.const.zeroTime,1),s=t.utility.clamp(o**.75*(1-o**.75),t.const.zeroGain,1);return t.audio.ramp.set(this.delay.delayTime,a),t.audio.ramp.set(this.send.gain,s),this}},"object"==typeof module&&"object"==typeof module.exports&&(module.exports=t),"function"==typeof define&&define.amd&&define("syngen",[],()=>t),"undefined"!=typeof self?self.syngen=t:this.syngen=t})();